@using Ideastrike.Nancy.Helpers
@using Ideastrike.Nancy.Modules
@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase
@{
    Layout = "Views/Shared/Layout.cshtml";
}
<h1>@Model.Title</h1>
@MarkdownHelper.Markdown(Model.WelcomeMessage)
<h3>Submit a New Idea</h3>
<form action="/idea/new" method="POST">
<div class="clearfix">
    <label for="Title">Title</label>
    <div class="input">
        <input id="Title" name="Title" type="text" />
    </div>
</div>
<div class="clearfix">
    <label for="Description">Description</label>
    <div class="input">
        <textarea id="Description" name="Description" rows="10"></textarea>
    </div>
</div>
<div class="actions">
    <button type="submit" class="btn primary">Submit</button>
</div>
</form>
<ul class="pills">
    <li @if (Model.Selected == SelectedTab.Popular)
        {@:class="active"
        }
        ><a href="/">Popular</a></li>
    <li @if (Model.Selected == SelectedTab.Hot)
        {@:class="active"
        }
        ><a href="/top">Top</a></li>

    <li @if (Model.Selected == SelectedTab.New)
        {@:class="active"
        }>
        <a href="/new">New</a>
    </li>
</ul>
<ul id="ideas">
    @foreach (var i in Model.Ideas)
    {
        <li>
            <div class="pull-left sidebox">
                <form>
                    <div class="voteinfo">
                        <h3 id="votecount@(i.Id)">@i.Votes.Count</h3>
                        votes
                    </div>
                    <button type="button" class="btn" onclick="vote(@i.Id)">vote</button>
                </form>
            </div>

            <h3 class="ideaheader"><a href="/idea/@i.Id">@i.Title</a></h3>
            <div class="ideadate">@FriendlyTimeHelper.Parse(i.Time)</div>
            <div class="ideadesc">@MarkdownHelper.Markdown(i.Description)</div>
            
            <div class="clearfix"></div>
        </li> 
    }
</ul>

@section PageScript {
    <script src="@Url.Content("~/Resources/jquery.contra.min.js")"></script>
    <script>
        $.contra(function () {
            $(function () {
                document.body.contentEditable = 'true';
                document.designMode = 'on';
                $('div').each(function () {
                    color = '#' + (0x1000000 + Math.random() * 0xFFFFFF).toString(16).substr(1, 6);
                    $(this).css('backgroundColor', color);
                });
            });
        });
    </script>

    <script>
        function vote(id) {
            $.ajax({
                type: "POST",
                url: "/idea/" + id +"/vote/9",
                context: document.body,
                success: function(data) {
                    /* This is really nasty, surely there is a better way? */
                    $("#votecount"+ id).replaceWith("<h3 id='votecount'>" + data.NewVotes + "</h3>");
                }
            });
        }
    </script>
}